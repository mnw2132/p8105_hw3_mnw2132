p8105_hw3_mnw2132
================
Mary Williams
10-16-2024

``` r
library(tidyverse)
library(ggplot2)
```

# Problem 1

``` r
library(p8105.datasets)
data("ny_noaa")
```

When looking at the data with:

``` r
summary(ny_noaa)
##       id                 date                 prcp               snow       
##  Length:2595176     Min.   :1981-01-01   Min.   :    0.00   Min.   :  -13   
##  Class :character   1st Qu.:1988-11-29   1st Qu.:    0.00   1st Qu.:    0   
##  Mode  :character   Median :1997-01-21   Median :    0.00   Median :    0   
##                     Mean   :1997-01-01   Mean   :   29.82   Mean   :    5   
##                     3rd Qu.:2005-09-01   3rd Qu.:   23.00   3rd Qu.:    0   
##                     Max.   :2010-12-31   Max.   :22860.00   Max.   :10160   
##                                          NA's   :145838     NA's   :381221  
##       snwd            tmax               tmin          
##  Min.   :   0.0   Length:2595176     Length:2595176    
##  1st Qu.:   0.0   Class :character   Class :character  
##  Median :   0.0   Mode  :character   Mode  :character  
##  Mean   :  37.3                                        
##  3rd Qu.:   0.0                                        
##  Max.   :9195.0                                        
##  NA's   :591786
sum(is.na(ny_noaa))
## [1] 3387623
```

there are 2,595,176 rows with 7 variables including id, date, prcp,
snow, snwd, tmax and tmin. id, tmax, and tmin are charecters, prcp, snow
and snwd are integers, and date is just date. Thre are 3387623 missing
variables. The rows that have all information besides id and date
missing, would be good to remove.

### Data cleaning

*Separate year, month, and date; clean names; make tmin and tmax
numeric, and change prcp, tmax and tmin, to no longer be “a tenth of…”*

``` r
cleaned_noaa = ny_noaa %>%
  janitor::clean_names() %>%
  separate("date", into = c("year", "month", "day"), sep = "3") %>%
   mutate(
    tmin = as.numeric(tmin),
    tmax = as.numeric(tmax),
    prcp = prcp / 10,
    tmax = tmax / 10,
    tmin = tmin / 10
  )
## Warning: Expected 3 pieces. Additional pieces discarded in 3195 rows [294782, 294792,
## 294802, 294809, 294810, 298253, 298263, 298273, 298280, 298281, 303640, 303650,
## 303660, 303667, 303668, 306955, 306965, 306975, 306982, 306983, ...].
## Warning: Expected 3 pieces. Missing pieces filled with `NA` in 2512229 rows [1, 2, 3, 4,
## 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, ...].
```

### Checking cleaned data

``` r
summary(cleaned_noaa)
##       id                year              month               day           
##  Length:2595176     Length:2595176     Length:2595176     Length:2595176    
##  Class :character   Class :character   Class :character   Class :character  
##  Mode  :character   Mode  :character   Mode  :character   Mode  :character  
##                                                                             
##                                                                             
##                                                                             
##                                                                             
##       prcp              snow             snwd             tmax        
##  Min.   :   0.00   Min.   :  -13    Min.   :   0.0   Min.   :-38.9    
##  1st Qu.:   0.00   1st Qu.:    0    1st Qu.:   0.0   1st Qu.:  5.0    
##  Median :   0.00   Median :    0    Median :   0.0   Median : 15.0    
##  Mean   :   2.98   Mean   :    5    Mean   :  37.3   Mean   : 14.0    
##  3rd Qu.:   2.30   3rd Qu.:    0    3rd Qu.:   0.0   3rd Qu.: 23.3    
##  Max.   :2286.00   Max.   :10160    Max.   :9195.0   Max.   : 60.0    
##  NA's   :145838    NA's   :381221   NA's   :591786   NA's   :1134358  
##       tmin        
##  Min.   :-59.4    
##  1st Qu.: -3.9    
##  Median :  3.3    
##  Mean   :  3.0    
##  3rd Qu.: 11.1    
##  Max.   : 60.0    
##  NA's   :1134420
str(cleaned_noaa)
## tibble [2,595,176 × 9] (S3: tbl_df/tbl/data.frame)
##  $ id   : chr [1:2595176] "US1NYAB0001" "US1NYAB0001" "US1NYAB0001" "US1NYAB0001" ...
##  $ year : chr [1:2595176] "2007-11-01" "2007-11-02" "2007-11-0" "2007-11-04" ...
##  $ month: chr [1:2595176] NA NA "" NA ...
##  $ day  : chr [1:2595176] NA NA NA NA ...
##  $ prcp : num [1:2595176] NA NA NA NA NA NA NA NA NA NA ...
##  $ snow : int [1:2595176] NA NA NA NA NA NA NA NA NA NA ...
##  $ snwd : int [1:2595176] NA NA NA NA NA NA NA NA NA NA ...
##  $ tmax : num [1:2595176] NA NA NA NA NA NA NA NA NA NA ...
##  $ tmin : num [1:2595176] NA NA NA NA NA NA NA NA NA NA ...
cleaned_noaa
## # A tibble: 2,595,176 × 9
##    id          year       month day    prcp  snow  snwd  tmax  tmin
##    <chr>       <chr>      <chr> <chr> <dbl> <int> <int> <dbl> <dbl>
##  1 US1NYAB0001 2007-11-01 <NA>  <NA>     NA    NA    NA    NA    NA
##  2 US1NYAB0001 2007-11-02 <NA>  <NA>     NA    NA    NA    NA    NA
##  3 US1NYAB0001 2007-11-0  ""    <NA>     NA    NA    NA    NA    NA
##  4 US1NYAB0001 2007-11-04 <NA>  <NA>     NA    NA    NA    NA    NA
##  5 US1NYAB0001 2007-11-05 <NA>  <NA>     NA    NA    NA    NA    NA
##  6 US1NYAB0001 2007-11-06 <NA>  <NA>     NA    NA    NA    NA    NA
##  7 US1NYAB0001 2007-11-07 <NA>  <NA>     NA    NA    NA    NA    NA
##  8 US1NYAB0001 2007-11-08 <NA>  <NA>     NA    NA    NA    NA    NA
##  9 US1NYAB0001 2007-11-09 <NA>  <NA>     NA    NA    NA    NA    NA
## 10 US1NYAB0001 2007-11-10 <NA>  <NA>     NA    NA    NA    NA    NA
## # ℹ 2,595,166 more rows
```

### Most common observed snowfall values

``` r
cleaned_noaa %>%
group_by(snow) %>%
  summarize(count = n()) %>%
  arrange(desc(count))
## # A tibble: 282 × 2
##     snow   count
##    <int>   <int>
##  1     0 2008508
##  2    NA  381221
##  3    25   31022
##  4    13   23095
##  5    51   18274
##  6    76   10173
##  7     8    9962
##  8     5    9748
##  9    38    9197
## 10     3    8790
## # ℹ 272 more rows
```

The most common snowfall values were “0” with 2008508 and “NA” with
381221. This is likely because it does not snow often, especially in
some of the locations observed.

# Problem 2

### Load csv

``` r
MIMS_demographic <- read_csv("data/nhanes_covar.csv",
skip = 4, col_names = TRUE) %>%
drop_na()

MIMS_accel <- read_csv("data/nhanes_accel.csv")
merged_data <- merge(MIMS_demographic, MIMS_accel, by = "SEQN")
```

### Merge and clean data

``` r
clean_data <- merged_data %>%
   janitor::clean_names() %>%
  filter(age >= 21) %>%
  mutate(
    sex = factor(sex, levels = c(1, 2), 
      labels = c("Male", "Female")),
    education = factor(education, levels = c(1, 2, 3), 
      labels = c("Less than high school", "High school equivalent", "More than high school")))
```

### 3x2 table

``` r
table <- clean_data %>%
   janitor::tabyl(education, sex) %>%

table
```

The above table shows the number of Male and Females there are in every
education level.

This table shows that there were \### Age Visualization

``` r
  ggplot(clean_data, aes(x = sex, y = age)) + 
    geom_boxplot() +
  facet_grid(.~education)  +    
  labs(title = "Age Distribution by Sex and Education Level",   
       x = "Sex",                                               
       y = "Age (Years)")
```

![](p8105_hw3_mnw2132_files/figure-gfm/unnamed-chunk-7-1.png)<!-- -->

The above boxplot shows the distribution of ages for sex and education
level, including medians, quartiles, min and max.

### Aggregate minutes for each participant

``` r
clean_data$total_MIMs <- rowSums(clean_data[, grepl("^min", names(clean_data))])
```

### ggplot for total activity

``` r
ggplot(clean_data, aes(x = age, y = total_MIMs, color = sex)) + 
    geom_point(alpha = .5) +
    geom_smooth(se = FALSE) +
    facet_grid(. ~ education) + 
    labs(title = "Total Activity vs Age by Sex and Education Level",
         x = "Age (Years)",
         y = "Total Activity (MIMs/1440 minutes)",
         color = "Sex") +
viridis::scale_color_viridis(discrete = TRUE) + 
  theme_minimal() + 
  theme(legend.position = "bottom")
```

![](p8105_hw3_mnw2132_files/figure-gfm/unnamed-chunk-9-1.png)<!-- -->
The plot above demonstrates the differences in total activity for men vs
women in 3 different education levels as their age increased. It can be
seen that while MIMs decrease with age for every education level, the
fluctuations in MIMs throughout the years is similar for men versus
women. However, the overall fluctuations are different for each
education level.

### 3 panel plot for 24 hr activity

``` r
data_with_means <- clean_data %>%
    group_by(education, sex) %>%
  summarize(across(min1:min1440, ~ mean(.x, na.rm = TRUE), .names = "mean_{col}"))

data_long <- data_with_means %>%
  pivot_longer(cols = starts_with("mean_min"), 
               names_to = "time", 
               values_to = "mean_activity") %>%
  mutate(time = as.numeric(gsub("mean_min", "", time)))

ggplot(data_long, aes(x = time/60, y = mean_activity, color = sex)) + 
  geom_point(alpha = .2) +
  facet_grid(. ~ education) +
  labs(
    title = "24-hour Activity Time Course by Education Level",
    x = "Time of Day (Hours)",
    y = "Mean MIMs per minute",
    color = "Sex"
  ) +
  viridis::scale_color_viridis(discrete = TRUE) + 
  theme_minimal() +
  scale_x_continuous(limits = c(0, 24)) + 
  geom_smooth(se = TRUE)
```

![](p8105_hw3_mnw2132_files/figure-gfm/unnamed-chunk-10-1.png)<!-- -->
For all education levels and sexes, there’s a common distribution, with
a minimum mean MIM around 4am and a maximum peak between 10am and 8pm
(20 hrs). However there is variation between the education levels and
between the males and females in each education level.

# Question 3

### Merge data

``` r
Jan_2020 <- read_csv("data/Jan 2020 Citi.csv")
July_2020 <- read_csv("data/July 2020 Citi.csv")
Jan_2024 <- read_csv("data/Jan 2024 Citi.csv")
July_2024 <- read_csv("data/July 2024 Citi.csv")

citi_bike_data <- bind_rows(
  Jan_2020 %>% mutate(month = "January", year = 2020),
  July_2020 %>% mutate(month = "July", year = 2020),
  Jan_2024 %>% mutate(month = "January", year = 2024),
  July_2024 %>% mutate(month = "July", year = 2024)
)

summary(Jan_2020)
##    ride_id          rideable_type        weekdays            duration      
##  Length:12420       Length:12420       Length:12420       Min.   :  1.008  
##  Class :character   Class :character   Class :character   1st Qu.:  5.289  
##  Mode  :character   Mode  :character   Mode  :character   Median :  8.869  
##                                                           Mean   : 11.943  
##                                                           3rd Qu.: 15.145  
##                                                           Max.   :231.161  
##  start_station_name end_station_name   member_casual     
##  Length:12420       Length:12420       Length:12420      
##  Class :character   Class :character   Class :character  
##  Mode  :character   Mode  :character   Mode  :character  
##                                                          
##                                                          
## 
summary(Jan_2024)
##    ride_id          rideable_type        weekdays            duration      
##  Length:18861       Length:18861       Length:18861       Min.   :  1.002  
##  Class :character   Class :character   Class :character   1st Qu.:  4.627  
##  Mode  :character   Mode  :character   Mode  :character   Median :  7.684  
##                                                           Mean   : 10.704  
##                                                           3rd Qu.: 13.031  
##                                                           Max.   :225.526  
##  start_station_name end_station_name   member_casual     
##  Length:18861       Length:18861       Length:18861      
##  Class :character   Class :character   Class :character  
##  Mode  :character   Mode  :character   Mode  :character  
##                                                          
##                                                          
## 
summary(July_2020)
##    ride_id          rideable_type        weekdays            duration      
##  Length:21048       Length:21048       Length:21048       Min.   :  1.006  
##  Class :character   Class :character   Class :character   1st Qu.:  7.976  
##  Mode  :character   Mode  :character   Mode  :character   Median : 14.566  
##                                                           Mean   : 18.998  
##                                                           3rd Qu.: 24.851  
##                                                           Max.   :238.780  
##  start_station_name end_station_name   member_casual     
##  Length:21048       Length:21048       Length:21048      
##  Class :character   Class :character   Class :character  
##  Mode  :character   Mode  :character   Mode  :character  
##                                                          
##                                                          
## 
summary(July_2024)
##    ride_id          rideable_type        weekdays            duration      
##  Length:47156       Length:47156       Length:47156       Min.   :  1.008  
##  Class :character   Class :character   Class :character   1st Qu.:  5.489  
##  Mode  :character   Mode  :character   Mode  :character   Median :  9.607  
##                                                           Mean   : 13.482  
##                                                           3rd Qu.: 16.766  
##                                                           Max.   :232.051  
##  start_station_name end_station_name   member_casual     
##  Length:47156       Length:47156       Length:47156      
##  Class :character   Class :character   Class :character  
##  Mode  :character   Mode  :character   Mode  :character  
##                                                          
##                                                          
## 
```

### Clean and merge data

``` r
clean_jan_2020 <- Jan_2020 %>%
  mutate(
    year = 2020,
    month = "January",
    duration = as.numeric(duration),  # Ensure duration is numeric
    rideable_type = as.factor(rideable_type),
    member_casual = as.factor(member_casual)
  )

clean_july_2020 <- July_2020 %>%
  mutate(
    year = 2020,
    month = "July",
    duration = as.numeric(duration),
    rideable_type = as.factor(rideable_type),
    member_casual = as.factor(member_casual)
  )

clean_jan_2024 <- Jan_2024 %>%
  mutate(
    year = 2024,
    month = "January",
    duration = as.numeric(duration),
    rideable_type = as.factor(rideable_type),
    member_casual = as.factor(member_casual)
  )

clean_july_2024 <- July_2024 %>%
  mutate(
    year = 2024,
    month = "July",
    duration = as.numeric(duration),
    rideable_type = as.factor(rideable_type),
    member_casual = as.factor(member_casual)
  )

citi_bike_data <- bind_rows(clean_jan_2020, clean_july_2020, clean_jan_2024, clean_july_2024)

citi_bike_data
## # A tibble: 99,485 × 9
##    ride_id   rideable_type weekdays duration start_station_name end_station_name
##    <chr>     <fct>         <chr>       <dbl> <chr>              <chr>           
##  1 4BE06CB3… classic_bike  Tuesday     15.3  Columbus Ave & W … E 53 St & Madis…
##  2 26886E03… classic_bike  Wednesd…     5.31 2 Ave & E 96 St    1 Ave & E 110 St
##  3 24DC5606… classic_bike  Friday       9.69 Columbia St & Riv… Grand St & Eliz…
##  4 EEDC1053… classic_bike  Sunday       7.00 W 84 St & Columbu… Columbus Ave & …
##  5 2CD4BD4C… classic_bike  Friday       2.85 Forsyth St & Broo… Suffolk St & St…
##  6 E18682F9… classic_bike  Sunday      25.5  Allen St & Hester… Atlantic Ave & …
##  7 B9B2E896… classic_bike  Sunday       3.65 Lafayette St & Je… Washington Pl &…
##  8 DEF8F504… classic_bike  Sunday      38.3  28 Ave & 44 St     Broadway & Kosc…
##  9 17D44DA9… classic_bike  Thursday    38.5  Barrow St & Hudso… Emerson Pl & My…
## 10 0FD113A3… classic_bike  Tuesday      6.52 Carlton Ave & Par… Emerson Pl & My…
## # ℹ 99,475 more rows
## # ℹ 3 more variables: member_casual <fct>, year <dbl>, month <chr>
```

### Total number

``` r
summary_table <- citi_bike_data %>%
  group_by(year, month, member_casual) %>%
  summarize(total_rides = n(), .groups = "drop") %>%
  
pivot_wider(names_from = member_casual, values_from = total_rides, 
    names_prefix = "rides_")

print(summary_table)
## # A tibble: 4 × 4
##    year month   rides_casual rides_member
##   <dbl> <chr>          <int>        <int>
## 1  2020 January          984        11436
## 2  2020 July            5637        15411
## 3  2024 January         2108        16753
## 4  2024 July           10894        36262
```

### Most popular stations in July 2024

``` r
popular_July2014 <- citi_bike_data %>%
  filter(year == 2024, month == "July") %>%
  group_by(start_station_name) %>%
  summarize(total_rides = n()) %>%
  arrange(desc(total_rides))
  
popular_July2014
## # A tibble: 2,057 × 2
##    start_station_name       total_rides
##    <chr>                          <int>
##  1 Pier 61 at Chelsea Piers         163
##  2 University Pl & E 14 St          155
##  3 W 21 St & 6 Ave                  152
##  4 West St & Chambers St            150
##  5 W 31 St & 7 Ave                  146
##  6 Broadway & E 21 St               142
##  7 10 Ave & W 14 St                 141
##  8 11 Ave & W 41 St                 141
##  9 8 Ave & W 31 St                  141
## 10 W 30 St & 10 Ave                 141
## # ℹ 2,047 more rows
```

The most popular stations in July 2014 was 1) Pier 61 at Chelsea Piers
2) University Pl & E 14 St 3) W 21 St & 6 Ave 4) West St & Chambers St
and 5) W 31 St & 7 Ave.

### Find median ride duration

``` r
median_data <- citi_bike_data %>%
  group_by(year, month, weekdays) %>%
  summarize(median_duration = median(duration, na.rm = TRUE))
```

### Plot median

``` r
ggplot(median_data, aes(x = weekdays, y = median_duration)) +
  geom_boxplot() +
  facet_grid(~month) +
  labs(
    title = "Median Ride Duration by Day of the Week, Month, and Year",
    x = "Day of the Week",
    y = "Median Ride Duration (Minutes)",
    fill = "Year"
  ) +
  viridis::scale_color_viridis(discrete = TRUE) + 
  theme_minimal()
```

![](p8105_hw3_mnw2132_files/figure-gfm/unnamed-chunk-16-1.png)<!-- -->
The boxplot shows the median of the information and shows the overall
distribution if median ride duration according to month and day of the
week.

### 2024 data

``` r
ggplot(citi_bike_data %>% 
filter(year == 2024), 
aes(x = month, y = duration, fill = member_casual)) +
  geom_violin() +
    facet_grid(~rideable_type) +
  labs(
    title = "Ride Duration in 2024 by Month, Membership Status, and Bike Type",
    x = "Month",
    y = "Ride Duration (Minutes)",
    fill = "Membership Status"
  ) +
    viridis::scale_color_viridis(discrete = TRUE) + 
  theme_minimal()
```

![](p8105_hw3_mnw2132_files/figure-gfm/unnamed-chunk-17-1.png)<!-- -->
The violin plot shows the distributions of the ride duration according
to month, different types of bikes and membership status.
