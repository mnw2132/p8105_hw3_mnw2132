---
title: "p8105_hw3_mnw2132"
author: "Mary Williams"
date: "10-16-2024"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(collapse = TRUE, message = FALSE)
```

```{r load_libraries}
library(tidyverse)
library(ggplot2)
```

# Problem 1

```{r}
library(p8105.datasets)
data("ny_noaa")
```

When looking at the data with: 
```{r}
summary(ny_noaa)
sum(is.na(ny_noaa))
```
there are 2,595,176 rows with 7 variables including id, date, prcp, snow, snwd, tmax and tmin. id, tmax, and tmin are charecters, prcp, snow and snwd are integers, and date is just date. Thre are 3387623 missing variables. The rows that have all information besides id and date missing, would be good to remove. 

### Data cleaning
*Separate year, month, and date; clean names; make tmin and tmax numeric, and change prcp, tmax and tmin, to no longer be "a tenth of..."*
```{r  clean_data}
cleaned_noaa = ny_noaa %>%
  janitor::clean_names() %>%
  separate("date", into = c("year", "month", "day"), sep = "3") %>%
   mutate(
    tmin = as.numeric(tmin),
    tmax = as.numeric(tmax),
    prcp = prcp / 10,
    tmax = tmax / 10,
    tmin = tmin / 10
  )
```
### Checking cleaned data 
```{r}
summary(cleaned_noaa)
str(cleaned_noaa)
cleaned_noaa
```

### Most common observed snowfall values
```{r common_observed_snowfall}
cleaned_noaa %>%
group_by(snow) %>%
  summarize(count = n()) %>%
  arrange(desc(count))
```
The most common snowfall values were "0" with 2008508 and "NA" with 381221. This is likely because it does not snow often, especially in some of the locations observed. 


# Problem 2
### Load csv
```{r}
MIMS_demographic <- read_csv("data/nhanes_covar.csv",
skip = 4, col_names = TRUE) %>%
drop_na()

MIMS_accel <- read_csv("data/nhanes_accel.csv")
merged_data <- merge(MIMS_demographic, MIMS_accel, by = "SEQN")
```

### Merge and clean data
```{r}
clean_data <- merged_data %>%
   janitor::clean_names() %>%
  filter(age >= 21) %>%
  mutate(
    sex = factor(sex, levels = c(1, 2), 
      labels = c("Male", "Female")),
    education = factor(education, levels = c(1, 2, 3), 
      labels = c("Less than high school", "High school equivalent", "More than high school")))
```
### 3x2 table
```{r}
table <- clean_data %>%
   janitor::tabyl(education, sex) %>%

table
```
The above table shows the number of Male and Females there are in every education level. 

This table shows that there were 
### Age Visualization
```{r}
  ggplot(clean_data, aes(x = sex, y = age)) + 
    geom_boxplot() +
  facet_grid(.~education)  +    
  labs(title = "Age Distribution by Sex and Education Level",   
       x = "Sex",                                               
       y = "Age (Years)")
```

The above boxplot shows the distribution of ages for sex and education level, including medians, quartiles, min and max. 

### Aggregate minutes for each participant 
```{r}
clean_data$total_MIMs <- rowSums(clean_data[, grepl("^min", names(clean_data))])
```

### ggplot for total activity 
```{r}
ggplot(clean_data, aes(x = age, y = total_MIMs, color = sex)) + 
    geom_point(alpha = .5) +
    geom_smooth(se = FALSE) +
    facet_grid(. ~ education) + 
    labs(title = "Total Activity vs Age by Sex and Education Level",
         x = "Age (Years)",
         y = "Total Activity (MIMs/1440 minutes)",
         color = "Sex") +
viridis::scale_color_viridis(discrete = TRUE) + 
  theme_minimal() + 
  theme(legend.position = "bottom")
```
The plot above demonstrates the differences in total activity for men vs women in 3 different education levels as their age increased. It can be seen that while MIMs decrease with age for every education level, the fluctuations in MIMs throughout the years is similar for men versus women. However, the overall fluctuations are different for each education level. 

### 3 panel plot for 24 hr activity
```{r}
data_with_means <- clean_data %>%
    group_by(education, sex) %>%
  summarize(across(min1:min1440, ~ mean(.x, na.rm = TRUE), .names = "mean_{col}"))

data_long <- data_with_means %>%
  pivot_longer(cols = starts_with("mean_min"), 
               names_to = "time", 
               values_to = "mean_activity") %>%
  mutate(time = as.numeric(gsub("mean_min", "", time)))

ggplot(data_long, aes(x = time/60, y = mean_activity, color = sex)) + 
  geom_point(alpha = .2) +
  facet_grid(. ~ education) +
  labs(
    title = "24-hour Activity Time Course by Education Level",
    x = "Time of Day (Hours)",
    y = "Mean MIMs per minute",
    color = "Sex"
  ) +
  viridis::scale_color_viridis(discrete = TRUE) + 
  theme_minimal() +
  scale_x_continuous(limits = c(0, 24)) + 
  geom_smooth(se = TRUE)
```
For all education levels and sexes, there's a common distribution, with a minimum mean MIM around 4am and a maximum peak between 10am and 8pm (20 hrs). However there is variation between the education levels and between the males and females in each education level. 


# Question 3
### Merge data
```{r}
Jan_2020 <- read_csv("data/Jan 2020 Citi.csv")
July_2020 <- read_csv("data/July 2020 Citi.csv")
Jan_2024 <- read_csv("data/Jan 2024 Citi.csv")
July_2024 <- read_csv("data/July 2024 Citi.csv")

citi_bike_data <- bind_rows(
  Jan_2020 %>% mutate(month = "January", year = 2020),
  July_2020 %>% mutate(month = "July", year = 2020),
  Jan_2024 %>% mutate(month = "January", year = 2024),
  July_2024 %>% mutate(month = "July", year = 2024)
)

summary(Jan_2020)
summary(Jan_2024)
summary(July_2020)
summary(July_2024)
```

### Clean and merge data
```{r}
clean_jan_2020 <- Jan_2020 %>%
  mutate(
    year = 2020,
    month = "January",
    duration = as.numeric(duration),  # Ensure duration is numeric
    rideable_type = as.factor(rideable_type),
    member_casual = as.factor(member_casual)
  )

clean_july_2020 <- July_2020 %>%
  mutate(
    year = 2020,
    month = "July",
    duration = as.numeric(duration),
    rideable_type = as.factor(rideable_type),
    member_casual = as.factor(member_casual)
  )

clean_jan_2024 <- Jan_2024 %>%
  mutate(
    year = 2024,
    month = "January",
    duration = as.numeric(duration),
    rideable_type = as.factor(rideable_type),
    member_casual = as.factor(member_casual)
  )

clean_july_2024 <- July_2024 %>%
  mutate(
    year = 2024,
    month = "July",
    duration = as.numeric(duration),
    rideable_type = as.factor(rideable_type),
    member_casual = as.factor(member_casual)
  )

citi_bike_data <- bind_rows(clean_jan_2020, clean_july_2020, clean_jan_2024, clean_july_2024)

citi_bike_data
```

### Total number
```{r}
summary_table <- citi_bike_data %>%
  group_by(year, month, member_casual) %>%
  summarize(total_rides = n(), .groups = "drop") %>%
  
pivot_wider(names_from = member_casual, values_from = total_rides, 
    names_prefix = "rides_")

print(summary_table)
```

### Most popular stations in July 2024
```{r}
popular_July2014 <- citi_bike_data %>%
  filter(year == 2024, month == "July") %>%
  group_by(start_station_name) %>%
  summarize(total_rides = n()) %>%
  arrange(desc(total_rides))
  
popular_July2014
```
The most popular stations in July 2014 was 1) Pier 61 at Chelsea Piers 2) University Pl & E 14 St 3) W 21 St & 6 Ave 4) West St & Chambers St and 5) W 31 St & 7 Ave. 

### Find median ride duration 
```{r}
median_data <- citi_bike_data %>%
  group_by(year, month, weekdays) %>%
  summarize(median_duration = median(duration, na.rm = TRUE))
```

### Plot median 
```{r}
ggplot(median_data, aes(x = weekdays, y = median_duration)) +
  geom_boxplot() +
  facet_grid(~month) +
  labs(
    title = "Median Ride Duration by Day of the Week, Month, and Year",
    x = "Day of the Week",
    y = "Median Ride Duration (Minutes)",
    fill = "Year"
  ) +
  viridis::scale_color_viridis(discrete = TRUE) + 
  theme_minimal()
```
The boxplot shows the median of the information and shows the overall distribution if median ride duration according to month  and day of the week. 

### 2024 data
```{r}
ggplot(citi_bike_data %>% 
filter(year == 2024), 
aes(x = month, y = duration, fill = member_casual)) +
  geom_violin() +
    facet_grid(~rideable_type) +
  labs(
    title = "Ride Duration in 2024 by Month, Membership Status, and Bike Type",
    x = "Month",
    y = "Ride Duration (Minutes)",
    fill = "Membership Status"
  ) +
    viridis::scale_color_viridis(discrete = TRUE) + 
  theme_minimal()
```
The violin plot shows the distributions of the ride duration according to month, different types of bikes and membership status. 
